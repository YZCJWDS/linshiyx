# 🌟 宇宙超级无敌帅的临时邮箱管理系统

基于 Vue 3、TypeScript 和 Naive UI 构建的现代化临时邮箱管理系统前端，专为 Cloudflare Pages 部署优化。

## ✨ 主要特性

### 📧 邮件管理功能
- **🏊 三泳道布局**：直观的泳道式邮件管理设计
- **📧 邮件收发**：生成、查看和删除临时邮箱地址
- **📤 邮件发送**：完整的邮件发送功能，支持HTML和纯文本格式
- **💾 本地记录保存**：发送邮件后自动保存完整记录到本地文件
- **🎨 富文本邮件查看器**：支持HTML邮件的安全渲染
- **📎 附件支持**：下载邮件附件功能
- **🔍 搜索和过滤**：内置搜索快速查找邮件

### 🎨 用户界面
- **📱 响应式设计**：完美适配桌面、平板和手机
- **🌙 深色/浅色主题**：基于用户偏好的自动主题切换
- **🎯 选中高亮**：经典淡紫色凹陷风格的选中效果
- **🔴 新邮件提醒**：红色徽章显示新邮件数量
- **🖼️ 玻璃拟态背景**：现代化的毛玻璃视觉效果
- **📋 一键复制**：轻松复制邮箱地址和内容

### 🔧 技术特性
- **🔄 实时更新**：30秒自动静默刷新邮件列表
- **🛡️ 安全可靠**：采用安全最佳实践和CSP头部保护
- **📁 智能存储**：支持File System Access API和自动下载降级
- **🎭 管理员模式**：完整的管理员权限和功能

## 🏗️ 技术架构

### 技术栈
- **Vue 3** 组合式API
- **TypeScript** 类型安全
- **Naive UI** 美观的组件库
- **Pinia** 状态管理
- **Vite** 快速开发和构建
- **CSS Grid** 响应式布局
- **WebAssembly** 邮件解析器

### 项目结构
```
src/
├── components/          # Vue 组件
│   ├── TempEmailApp.vue        # 主应用容器
│   ├── EmailManager.vue        # 邮箱地址管理
│   ├── MailList.vue            # 邮件列表显示
│   ├── MailDetail.vue          # 邮件内容查看器
│   ├── AdminLogin.vue          # 管理员登录
│   ├── SendMailApp.vue         # 邮件发送主界面
│   ├── SendMailComposer.vue    # 邮件撰写组件
│   ├── SendMailAddressManager.vue # 发件邮箱管理
│   ├── SentMailList.vue        # 已发送邮件列表
│   ├── SentMailDetail.vue      # 已发送邮件详情
│   └── ShadowHtmlComponent.vue # 安全HTML渲染
├── stores/              # Pinia 状态管理
│   ├── email.ts            # 邮件状态管理
│   ├── ui.ts               # UI状态管理
│   ├── auth.ts             # 认证状态管理
│   └── settings.ts         # 设置状态管理
├── types/               # TypeScript 类型定义
├── utils/               # 工具函数
│   ├── api.ts              # API 客户端（含邮件记录保存器）
│   ├── helpers.ts          # 辅助函数
│   ├── mimeParser.ts       # MIME 邮件解析器
│   └── wasmMailParser.ts   # WASM 邮件解析器
├── styles/              # 全局样式
└── main.ts              # 应用程序入口
```

## 🚀 快速开始

### 环境要求
- Node.js 18 或更高版本
- npm 或 yarn

### 安装步骤
```bash
# 克隆仓库
git clone <repository-url>
cd linshiyx

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 开发命令
```bash
# 运行开发服务器（热重载）
npm run dev

# 类型检查
npm run type-check

# 代码检查
npm run lint

# 生产环境构建
npm run build

# 预览生产构建
npm run preview
```

## 📦 部署指南

### Cloudflare Pages（推荐）

#### 方式一：自动部署脚本
```bash
# 给脚本执行权限
chmod +x deploy.sh

# 运行部署脚本
./deploy.sh
```

#### 方式二：手动部署
1. 构建应用程序：
   ```bash
   npm run build
   ```

2. 将 `dist` 文件夹上传到 Cloudflare Pages

3. 配置构建设置：
   - **构建命令**: `npm run build`
   - **构建输出目录**: `dist`
   - **Node.js 版本**: `18`

#### 方式三：Git 集成（推荐）
1. 将您的仓库连接到 Cloudflare Pages
2. 设置构建配置：
   - **框架预设**: Vue
   - **构建命令**: `npm run build`
   - **构建输出目录**: `dist`
3. 根据需要添加环境变量

### 环境变量
在 Cloudflare Pages 控制台中配置以下变量：

- `VITE_API_BASE_URL`: 后端 API 地址
- `VITE_APP_TITLE`: 应用程序标题（可选）

### 自定义域名
1. 进入 Cloudflare Pages 控制台
2. 选择您的项目
3. 转到"自定义域名"选项卡
4. 添加您的域名并配置 DNS

## 📤 邮件发送功能

### 🎯 功能概述
系统提供完整的邮件发送功能，支持从任意临时邮箱地址发送邮件到任何收件人。

### 🚀 使用方法

#### 1. 进入发送界面
- 在主界面点击"发送邮件"按钮
- 进入三栏式发送界面

#### 2. 选择发件邮箱
- 左栏：显示所有可用的临时邮箱地址
- 点击选择发件邮箱（紫色凹陷效果表示选中）

#### 3. 撰写邮件
- 中栏：点击"发送新邮件"按钮
- 右栏：填写收件人、主题和邮件内容
- 支持纯文本和HTML格式

#### 4. 发送邮件
- 点击右栏顶部的"发送邮件"按钮
- 系统自动发送并保存记录

### 💾 本地记录保存

#### 🎯 自动保存机制
- **首次使用**：发送第一封邮件时，系统会弹出文件夹选择对话框
- **选择位置**：建议在桌面创建"EmailRecords"文件夹并选择
- **后续使用**：所有邮件记录自动保存到选择的文件夹，无需再次操作

#### 📋 记录内容
每个邮件记录包含完整信息：
```json
{
  "📧 邮件发送记录": {
    "📅 发送时间": "2024/01/01 14:30:45",
    "👤 发件人": "abc123@yzcjwds.xyz",
    "📮 收件人": "user@example.com",
    "📝 邮件主题": "测试邮件",
    "📄 内容格式": "纯文本格式",
    "📊 内容长度": "156 字符",
    "✅ 发送状态": "成功"
  },
  "📋 邮件内容": {
    "正文": "完整的邮件内容...",
    "原始格式": "TEXT"
  },
  "🔧 技术信息": {
    "记录ID": "mail_1704123456789",
    "时间戳": "2024-01-01T06:30:45.123Z",
    "保存时间": "2024-01-01T06:30:46.456Z",
    "应用版本": "1.0.0"
  }
}
```

#### 🔧 技术特性
- **智能存储**：支持现代浏览器的File System Access API
- **自动降级**：不支持的浏览器自动使用下载模式
- **健壮性**：多重备份机制，确保记录不丢失
- **可读性**：中文标签，JSON格式，易于查看

#### 📁 文件管理
- **文件名格式**：`邮件记录_2024-01-01_14-30-45.json`
- **查看方式**：可用记事本、VS Code等任何文本编辑器打开
- **存储位置**：用户自选，推荐桌面/EmailRecords文件夹

#### 🌐 浏览器兼容性
- **Chrome/Edge**：完整支持，保存到指定文件夹
- **Firefox/Safari**：自动下载到默认下载位置
- **权限管理**：智能处理文件夹访问权限

## 🔧 配置说明

### API 配置
在环境文件中更新 API 基础地址：

```bash
# .env.production
VITE_API_BASE_URL=https://your-api-domain.com

# .env.development
VITE_API_BASE_URL=http://localhost:8787
```

### 安全头部
应用程序包含在 `_headers` 中配置的安全头部：
- 内容安全策略 (CSP)
- X-Frame-Options
- X-Content-Type-Options
- 等等...

### 缓存策略
静态资源缓存 1 年，HTML 文件在每次请求时重新验证。

## 🎨 自定义配置

### 主题定制
应用程序支持浅色和深色主题。在 `src/styles/global.css` 中自定义颜色：

```css
:root {
  --primary-color: #18a058;
  --primary-color-hover: #36ad6a;
  /* ... 更多变量 */
}
```

### 布局调整
在 `src/components/TempEmailApp.vue` 中修改三列布局：

```css
.three-column-layout {
  grid-template-columns: 320px 400px 1fr;
  /* 根据需要调整列宽 */
}
```

### 邮件显示模式
支持四种邮件显示模式：
- 🌟 自动适配：跟随系统主题
- ☀️ 明亮模式：强制明亮显示
- 🌙 深色模式：强制深色显示
- 🔆 高对比度：最大化可读性

## 🔍 API 集成

前端需要以下 API 端点：

### 邮箱地址管理
- `GET /admin/address` - 获取邮箱地址列表
- `POST /admin/new_address` - 创建新邮箱地址
- `DELETE /admin/address/:id` - 删除邮箱地址

### 邮件管理
- `GET /admin/mails` - 获取邮件列表
- `GET /admin/mails/:id` - 获取邮件详情
- `DELETE /admin/mails/:id` - 删除邮件

### 邮件发送
- `POST /admin/send_mail` - 管理员发送邮件
  ```json
  {
    "from_name": "发件人姓名（可选）",
    "from_mail": "sender@yzcjwds.xyz",
    "to_name": "收件人姓名（可选）",
    "to_mail": "recipient@example.com",
    "subject": "邮件主题",
    "is_html": false,
    "content": "邮件内容"
  }
  ```

### 设置管理
- `GET /admin/user_settings` - 获取用户设置
- `POST /admin/user_settings` - 更新设置

## 🐛 故障排除

### 构建问题
- 确保 Node.js 版本为 18 或更高
- 清除 node_modules 并重新安装：`rm -rf node_modules package-lock.json && npm install`
- 检查 TypeScript 错误：`npm run type-check`

### 部署问题
- 验证所有环境变量已设置
- 检查 Cloudflare Pages 构建日志
- 确保 API 端点可从您的域名访问

### 运行时问题
- 检查浏览器控制台错误
- 验证 API 连接性
- 检查浏览器开发工具中的网络请求

### 邮件显示问题
- **时间显示错误**：检查系统时区设置
- **HTML邮件不显示**：尝试切换显示模式
- **新邮件计数错误**：清除浏览器缓存重试
- **背景图片不显示**：确保 preview.jpg 在 public 目录下

### 邮件发送问题
- **发送按钮不可见**：检查是否选择了发件邮箱
- **发送失败500错误**：检查后端Resend或SMTP配置
- **权限被拒绝**：确认管理员身份和认证状态
- **记录保存失败**：
  - Chrome/Edge：检查文件夹访问权限
  - Firefox/Safari：检查下载设置和权限
  - 通用：清除浏览器缓存重试

### 本地记录保存问题
- **首次选择文件夹失败**：
  - 确保使用Chrome或Edge浏览器
  - 检查浏览器版本（需86+）
  - 尝试刷新页面重新选择
- **记录文件无法打开**：
  - 确认文件扩展名为.json
  - 使用UTF-8编码的文本编辑器
  - 检查文件是否完整下载
- **权限过期问题**：
  - 重新发送邮件会自动重新请求权限
  - 或清除浏览器数据重新设置

## 📱 浏览器支持

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 🤝 贡献指南

1. Fork 本仓库
2. 创建功能分支
3. 进行您的更改
4. 运行测试和代码检查
5. 提交 Pull Request

## 📄 许可证

本项目采用 MIT 许可证。

## 🆘 技术支持

如有问题和疑问：
1. 查看故障排除部分
2. 搜索现有问题
3. 创建新问题并提供详细信息

## 📝 更新日志

### v1.2.0 - 邮件发送与本地记录功能 (2024-01-01)

#### ✨ 新增功能
- **📤 完整邮件发送功能**
  - 三栏式发送界面设计
  - 支持HTML和纯文本格式
  - 管理员权限发送邮件
  - 发送按钮置于顶部栏，永不遮挡

- **💾 智能本地记录保存**
  - 首次使用自动引导选择保存位置
  - 支持File System Access API（Chrome/Edge）
  - 自动降级到下载模式（Firefox/Safari）
  - 完整记录包含所有邮件信息

- **🎨 界面优化**
  - 经典淡紫色凹陷风格选中效果
  - 本地存储说明卡片
  - 响应式发送界面布局

#### 🔧 技术改进
- 新增EmailRecordSaver类，健壮的本地存储方案
- 多重备份机制，确保记录不丢失
- 智能权限管理和错误恢复
- 完整的TypeScript类型支持

#### 🐛 问题修复
- 修复发送按钮布局遮挡问题
- 优化API调用方式，与示例前端完全一致
- 改进错误处理和用户提示

### v1.1.0 - 基础功能完善
- 三泳道布局邮件管理
- 实时邮件刷新
- 玻璃拟态界面设计
- 深色/浅色主题支持

### v1.0.0 - 初始版本
- 基础临时邮箱功能
- 邮件查看和管理
- 管理员登录系统

## 🌟 特色功能

### 🎨 玻璃拟态设计
- 现代化的毛玻璃背景效果
- 多层次透明度设计
- 深色/浅色模式完美适配

### 📬 智能邮件管理
- 30秒自动静默刷新
- 新邮件红色徽章提醒
- 选中状态美观高亮
- 四种邮件显示模式

### 🛡️ 安全邮件渲染
- WebAssembly 邮件解析器
- Shadow DOM 安全渲染
- HTML 内容沙箱化处理
- 完美的 quoted-printable 解码

## 🎯 项目亮点

- ✨ **现代化设计**：玻璃拟态风格，美观大方
- 🚀 **高性能**：Vite 构建，加载迅速
- 📱 **响应式**：完美适配各种设备
- 🛡️ **安全可靠**：多重安全防护机制
- 🎨 **用户友好**：直观的三泳道布局
- 🔄 **实时更新**：智能的后台刷新机制

---

*使用 ❤️ 构建，基于 Vue 3、TypeScript 和 Naive UI*

**🌟 宇宙超级无敌帅的临时邮箱管理系统 - 让邮件管理变得简单而美好！**
